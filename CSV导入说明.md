# CSV 导入乱码问题解决方案

## ✅ 已支持自动编码转换!

**好消息:** 系统现在已经支持**自动检测和转换编码**!

无论您的 CSV 文件是什么编码(UTF-8、GBK、GB2312、Shift-JIS 等),系统都会自动识别并转换为正确的格式。

### 使用方法

1. 直接导入您的 CSV 文件(任何编码)
2. 系统会自动检测编码并转换
3. 导入完成后会显示检测到的编码类型,例如: `导入完成 (SJIS)：成功 10 条`
4. 按 F12 打开控制台可以看到详细的编码检测信息

### 支持的编码格式

- ✅ UTF-8 (带或不带 BOM)
- ✅ GBK / GB2312 (中文 Windows 默认)
- ✅ Shift-JIS (日文)
- ✅ EUC-JP (日文)
- ✅ UTF-16 LE/BE
- ✅ 以及其他常见编码

---

## 问题原因(仅供参考)

当您在 Windows 系统上使用 Excel 或记事本保存 CSV 文件时,默认编码可能是 **ANSI (GBK/GB2312)**,而不是 **UTF-8**。浏览器只能正确读取 UTF-8 编码的文件,因此会出现乱码。

## 解决方法

### 方法 1: 使用 Excel 正确保存 CSV (推荐)

1. 在 Excel 中打开您的 CSV 文件
2. 点击 **文件** → **另存为**
3. 在 **保存类型** 下拉菜单中选择 **CSV UTF-8 (逗号分隔)(\*.csv)**
4. 点击保存
5. 重新导入到系统中

### 方法 2: 使用记事本转换编码

1. 用 **记事本** 打开您的 CSV 文件
2. 点击 **文件** → **另存为**
3. 在底部的 **编码** 下拉菜单中选择 **UTF-8**
4. 点击保存(覆盖原文件)
5. 重新导入到系统中

### 方法 3: 使用 VSCode 转换编码

1. 用 **VSCode** 打开您的 CSV 文件
2. 点击右下角的编码显示(可能显示 "GBK" 或 "GB2312")
3. 选择 **通过编码重新打开** → **UTF-8**
4. 再次点击右下角的编码
5. 选择 **通过编码保存** → **UTF-8**
6. 保存文件后重新导入

### 方法 4: 使用 PowerShell 批量转换

如果您有多个 CSV 文件需要转换,可以使用以下 PowerShell 命令:

```powershell
# 转换单个文件
$content = Get-Content "您的文件.csv" -Encoding Default
$content | Out-File "您的文件_utf8.csv" -Encoding UTF8

# 批量转换当前目录下所有 CSV 文件
Get-ChildItem *.csv | ForEach-Object {
    $content = Get-Content $_.FullName -Encoding Default
    $content | Out-File "$($_.BaseName)_utf8.csv" -Encoding UTF8
}
```

## 验证编码是否正确

导入前,您可以:

1. 打开浏览器的 **开发者工具** (按 F12)
2. 切换到 **Console** 标签
3. 导入 CSV 文件
4. 查看控制台输出的调试信息:
   - 文件字节信息
   - 检测到的编码类型
   - 前 3 行内容预览

如果前 3 行内容显示正常的中文,说明编码正确。

## CSV 文件格式要求

正确的 CSV 格式示例:

```csv
姓名,物品类型,款式,尺寸,物品名称,数量,备注,时间
张三,衣服,黑,M,,1,日常使用,
李四,其它,,,口罩,10,紧急需要,
王五,衣服,灰蓝,L,,2,,
```

**注意事项:**

- 第一行必须是表头
- 如果是衣服类型,填写"款式"和"尺寸",物品名称留空
- 如果是其它物品,填写"物品名称",款式和尺寸留空
- 时间字段可以留空,系统会自动记录导入时间
- 数量必须是数字

## 仍然有问题?

如果按照上述方法操作后仍然出现乱码,请:

1. 检查浏览器控制台的调试信息
2. 确认文件确实是 UTF-8 编码
3. 尝试使用系统导出的 CSV 文件作为模板
