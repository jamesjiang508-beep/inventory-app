# 衣服库存管理系统 - 功能演示

## 项目概述

这是一个轻量级的衣服库存管理系统，支持库存管理、使用记录和剩余统计功能。

## 功能演示

### 1. 剩余总表预览（核心功能）

![剩余总表预览](../../../.gemini/antigravity/brain/a8bf0e08-29ef-4deb-b097-d49717c99d92/uploaded_image_2_1764821827419.png)

**功能说明**：

- 实时显示每个款式 × 尺寸的剩余库存
- 自动计算公式：`剩余 = 初始库存 - 已使用数量`
- 显示格式：
  - 有余量：`5 / 余4`（正常黑色）
  - 已欠货：`5 / 欠1`（红色加粗警告）

### 2. 使用记录详细

![使用记录详细](../../../.gemini/antigravity/brain/a8bf0e08-29ef-4deb-b097-d49717c99d92/uploaded_image_0_1764821827419.png)

**功能说明**：

- 快速录入使用信息（姓名、款式、尺寸、数量）
- 实时流水列表，按时间倒序显示
- 每条记录自动添加时间戳

### 3. 库存总表预览

![库存总表预览](../../../.gemini/antigravity/brain/a8bf0e08-29ef-4deb-b097-d49717c99d92/uploaded_image_1_1764821827419.png)

**功能说明**：

- 可视化编辑初始库存
- 矩阵表格输入（款式 × 尺寸）
- 批量修改后一键保存

---

## 快速开始

### 启动步骤

1. **安装依赖**（首次运行）

   ```bash
   npm install
   ```

2. **启动服务器**

   ```bash
   npm start
   ```

3. **访问应用**

   浏览器打开：`http://localhost:3000`

### Windows 快捷启动

直接双击 `start.bat` 文件

---

## 使用流程示例

### 场景：记录员工领用工作服

**步骤 1：设置初始库存**

1. 访问系统，点击"📦 库存总表预览"
2. 点击"✏️ 进入编辑"按钮
3. 设置库存，例如：
   - 黑色 M 码：5 件
   - 深蓝 M 码：5 件
4. 点击"💾 保存所有修改"

**步骤 2：员工领用**

1. 点击"📝 使用记录详细"
2. 添加记录：
   - 姓名：张三
   - 款式：黑
   - 尺寸：M
   - 数量：1
3. 点击"➕ 添加记录"

**步骤 3：查看剩余**

1. 点击"📊 剩余总表预览"
2. 查看"黑-M"单元格：显示 `5 / 余4`

**步骤 4：超额领用（测试欠货警告）**

1. 继续添加使用记录，直到总数超过 5 件
2. 查看剩余总表：单元格变为红色 `5 / 欠1`

---

## 技术实现

### 后端（server.js）

- **框架**: Express.js
- **数据库**: SQLite3
- **API 接口**: 7 个 REST 接口
- **核心算法**:
  ```javascript
  剩余 = 初始库存 - SUM(使用记录);
  ```

### 前端（index.html）

- **框架**: Vue 3 (CDN)
- **样式**: 原生 CSS（渐变设计）
- **特点**: 单文件应用，无需构建

### 数据库（inventory.db）

自动创建的 4 张表：

- `styles` - 款式表
- `sizes` - 尺寸表
- `stock_init` - 初始库存
- `usage_logs` - 使用流水

---

## API 测试

使用 curl 测试接口：

```bash
# 获取剩余总表
curl http://localhost:3000/api/stock/dashboard

# 添加使用记录
curl -X POST http://localhost:3000/api/usage/add \
  -H "Content-Type: application/json" \
  -d '{"user":"测试","style":"黑","size":"M","qty":1}'

# 查看使用流水
curl http://localhost:3000/api/usage/logs
```

---

## 项目特点

✅ **零配置启动** - 自动创建数据库和初始数据  
✅ **单文件前端** - 无需构建，直接运行  
✅ **轻量级** - SQLite 文件数据库，无需安装 MySQL  
✅ **现代设计** - 渐变色彩、平滑动画  
✅ **跨平台** - Windows/macOS/Linux 均可运行

---

## 常见问题

**Q: 数据保存在哪里？**  
A: 保存在项目目录下的 `inventory.db` SQLite 数据库文件中。

**Q: 如何备份数据？**  
A: 直接复制 `inventory.db` 文件即可。

**Q: 如何重置数据？**  
A: 删除 `inventory.db` 文件，重新启动服务器会自动创建新数据库。

**Q: 可以修改预设的款式和尺寸吗？**  
A: 可以，编辑 `server.js` 文件第 61-75 行的预设数据数组。

---

## 后续扩展

可以考虑的优化功能：

- Excel 导入/导出
- 使用记录编辑/删除
- 统计图表展示
- 多用户权限管理
- 打印报表功能

---

使用统计汇总功能实现总结
功能概述
实现了按姓名汇总的使用统计表格,显示每个用户使用的衣服总数和各类物品的总数量。

实现内容
后端修改
文件:
server.js
新增 API 接口: GET /api/usage/summary

功能: 从数据库汇总每个用户的使用数据

SQL 查询:

查询每个用户的衣服使用总量
查询每个用户的各类物品使用量
获取所有出现过的物品名称
返回数据示例:

{
"success": true,
"summary": [
{
"user_name": "张三",
"clothing_total": 5,
"items": {
"口罩": 10,
"手套": 2
}
}
],
"item_names": ["口罩", "手套"]
}
前端修改
文件:
index.html
新增数据属性:

usageSummary: 存储汇总统计数据
summaryItemNames: 存储物品名称列表
新增方法:

loadUsageSummary()
: 从 API 加载汇总数据
修改的方法:

init()
: 添加调用
loadUsageSummary()
addUsageLog()
: 添加记录后刷新汇总数据
deleteUsageLog()
: 删除记录后刷新汇总数据
视图切换:

列表视图 (☰): 显示详细的使用流水记录
网格视图 (⊞): 显示按姓名汇总的统计表格
汇总表格结构:

| 姓名 | 衣服 | 口罩 | 手套 | ... |
| ---- | ---- | ---- | ---- | --- |
| 张三 | 5    | 10   | 2    |
| 李四 | 3    | 5    | 0    |

功能特点
自动汇总: 数据库层面进行汇总,性能高效
实时更新: 添加或删除记录后自动刷新统计
动态列: 根据实际使用的物品类型动态生成列
零值显示: 如果某用户未使用某物品,显示 0
表格样式: 与现有表格样式保持一致
使用方法
启动服务器:

node server.js
访问系统: http://localhost:3000

切换到"使用记录"标签

点击"使用流水"标题右侧的 ⊞ 图标

查看按姓名汇总的统计表格

点击 ☰ 图标可切换回详细流水记录

修改的文件
server.js (后端)

添加 /api/usage/summary API 接口
实现数据库汇总查询逻辑
index.html (前端)

添加数据属性和方法
修改网格视图 HTML
集成数据刷新逻辑
测试建议
准备测试数据
添加以下使用记录:

张三: 衣服(黑,M) x2
张三: 衣服(白,L) x3
张三: 口罩 x10
李四: 衣服(灰蓝,XL) x1
李四: 口罩 x5
李四: 手套 x2
验证汇总结果
切换到网格视图,应该看到:

| 姓名 | 衣服 | 口罩 | 手套 |
| ---- | ---- | ---- | ---- |
| 张三 | 5    | 10   | 0    |
| 李四 | 1    | 5    | 2    |

验证实时更新
添加新记录: 王五使用衣服 x1
切换到网格视图,验证王五出现在表格中
删除一条记录,验证数据相应减少
注意事项
汇总表格不支持删除操作,需要在列表视图中删除
物品列的顺序按字母排序
衣服列汇总所有款式和尺寸的总数
刷新页面后数据会重新加载

更多详细信息请参阅 [README.md](README.md)
