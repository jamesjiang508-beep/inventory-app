# 库存管理系统

一个轻量级的库存管理和使用记录系统，支持**衣服库存**（款式 × 尺寸）和**其它物品**（单一物品）两种类型，采用 Vue 3 + Node.js + SQLite 架构。

> 📦 **特色功能**：支持多种物品类型、实时库存统计、使用流水记录、欠货预警

---

## ✨ 核心功能

### 1. 📊 剩余总表预览

**衣服库存**

- 实时显示每个款式 × 尺寸的剩余库存
- 自动计算：`初始库存 - 已使用数量 = 剩余`
- 智能提示：
  - 有余量 → **5**（绿色） / **余 4**（蓝色）
  - 已欠货 → **5**（绿色） / **欠 1**（红色加粗警告）

**其它物品**

- 独立区块显示其它物品库存
- 同样的颜色方案和欠货警告
- 示例：口罩 **100** / **余 80**

### 2. 📝 使用记录详细

**智能物品类型切换**

- 一键切换"衣服"和"其它物品"类型
- 衣服：姓名 + 款式 + 尺寸 + 数量 + 备注
- 其它物品：姓名 + 物品名称 + 数量 + 备注

**使用流水列表**

- 按时间倒序显示所有记录
- 时间列放在最后
- 自动区分物品类型（衣服显示款式尺寸，其它显示物品名）
- 支持备注信息

### 3. 📦 库存设置

**衣服初始库存**

- 可视化编辑初始库存矩阵
- 款式 × 尺寸 批量修改
- 一键保存所有修改

**其它物品管理**

- ➕ 添加新物品（名称 + 初始数量）
- ✏️ 编辑物品库存
- 🗑️ 删除物品
- 支持独立管理

---

## 🚀 快速开始

### 环境要求

- Node.js 14.0 或更高版本（推荐 18.x 或 20.x LTS）

### 安装步骤

1. **安装依赖**

```bash
npm install
```

2. **启动服务器**

```bash
npm start
```

3. **访问应用**

打开浏览器访问：`http://localhost:3000`

### Windows 快捷启动

直接双击 `start.bat` 文件

---

## 📁 项目结构

```
inventory-app/
├── server.js          # Node.js 后端（Express + SQL.js）
├── index.html         # Vue 3 前端（单页应用）
├── package.json       # 项目配置
├── inventory.db       # SQLite 数据库（自动生成）
├── walkthrough.md     # 功能演示教程
├── start.bat          # Windows 启动脚本
└── README.md          # 说明文档
```

---

## 🗄️ 数据库设计

系统使用 SQLite 数据库，启动时自动创建以下表：

### 表结构

| 表名          | 说明         | 主要字段                                                                                       |
| ------------- | ------------ | ---------------------------------------------------------------------------------------------- |
| `styles`      | 衣服款式表   | id, name, sort_order                                                                           |
| `sizes`       | 衣服尺寸表   | id, name, sort_order                                                                           |
| `stock_init`  | 衣服初始库存 | id, style_name, size_name, quantity                                                            |
| `other_items` | 其它物品表   | id, name, initial_quantity                                                                     |
| `usage_logs`  | 使用流水表   | id, user_name, item_type, style_name, size_name, other_item_name, quantity, remark, created_at |

### 预设数据

**衣服款式**: 黑、灰蓝、深蓝、白  
**衣服尺寸**: XS, S, M, L, XL

您可以通过修改 `server.js` 中的初始化脚本来自定义预设数据。

---

## 🔌 API 接口文档

### 衣服相关

| 方法 | 路径              | 说明             |
| ---- | ----------------- | ---------------- |
| GET  | `/api/styles`     | 获取所有款式     |
| GET  | `/api/sizes`      | 获取所有尺寸     |
| GET  | `/api/stock/init` | 获取初始库存矩阵 |
| POST | `/api/stock/init` | 更新初始库存     |

### 其它物品相关

| 方法   | 路径                   | 说明             |
| ------ | ---------------------- | ---------------- |
| GET    | `/api/other-items`     | 获取所有其它物品 |
| POST   | `/api/other-items`     | 添加新物品       |
| PUT    | `/api/other-items/:id` | 更新物品库存     |
| DELETE | `/api/other-items/:id` | 删除物品         |

### 通用接口

| 方法 | 路径                   | 说明                          |
| ---- | ---------------------- | ----------------------------- |
| GET  | `/api/stock/dashboard` | 获取剩余总表（衣服+其它物品） |
| GET  | `/api/usage/logs`      | 获取使用流水列表              |
| POST | `/api/usage/add`       | 添加使用记录（支持两种类型）  |

### API 请求示例

**添加其它物品**

```bash
curl -X POST http://localhost:3000/api/other-items \
  -H "Content-Type: application/json" \
  -d '{"name":"口罩","quantity":100}'
```

**添加使用记录（衣服）**

```bash
curl -X POST http://localhost:3000/api/usage/add \
  -H "Content-Type: application/json" \
  -d '{"user":"张三","itemType":"clothing","style":"黑","size":"M","qty":1,"remark":"日常使用"}'
```

**添加使用记录（其它物品）**

```bash
curl -X POST http://localhost:3000/api/usage/add \
  -H "Content-Type: application/json" \
  -d '{"user":"李四","itemType":"other","otherItemName":"口罩","qty":10,"remark":"紧急需要"}'
```

---

## 💡 使用指南

### 首次使用

#### 1. 设置衣服初始库存

- 点击"📦 库存设置"标签页
- 点击"✏️ 编辑"按钮
- 在表格中输入各款式 × 尺寸的初始数量
- 点击"💾 保存所有修改"

#### 2. 添加其它物品

- 在"📦 库存设置"页面的"其它物品管理"区域
- 点击"➕ 添加物品"
- 输入物品名称和初始数量
- 点击"保存物品"

#### 3. 记录使用

- 点击"📝 使用记录"标签页
- 选择物品类型（衣服/其它物品）
- 填写相应信息
- 点击"➕ 添加"

#### 4. 查看剩余

- 点击"📊 剩余总表"标签页
- 查看实时更新的库存剩余情况
- 红色数字表示已欠货，需要补货

### 高级功能

**编辑其它物品库存**

1. 在库存设置页面找到目标物品
2. 点击"编辑"按钮
3. 修改数量后点击"保存"

**删除其它物品**

1. 在库存设置页面找到目标物品
2. 点击"删除"按钮
3. 确认删除

---

## 🎨 技术栈

- **前端**: Vue 3 (CDN)
- **后端**: Node.js + Express
- **数据库**: SQL.js (纯 JavaScript SQLite 实现)
- **样式**: 原生 CSS（简约白色现代设计、响应式布局）

### 为什么使用 SQL.js？

- ✅ **纯 JavaScript** - 无需任何编译工具
- ✅ **跨平台** - Windows/Mac/Linux 都能运行
- ✅ **零依赖** - 不需要 Visual Studio 等构建工具
- ✅ **轻量快速** - 安装和启动都很快
- ✅ **文件持久化** - 数据保存在 `inventory.db` 文件中

编辑 `server.js` 第 8 行：

```javascript
const PORT = process.env.PORT || 3000; // 修改为你想要的端口
```

### 添加新的衣服款式/尺寸

编辑 `server.js` 第 65-66 行的预设数据数组。

### 自定义样式

编辑 `index.html` 的 `<style>` 部分，修改颜色、字体等。

---

## 🐛 常见问题

**Q: 启动时提示端口被占用？**  
A: 修改 `server.js` 中的 PORT 变量，或关闭占用端口的其他程序。

**Q: 数据库文件在哪里？**  
A: 在项目根目录下的 `inventory.db` 文件，可以使用 SQLite 客户端查看。

**Q: 如何备份数据？**  
A: 直接复制 `inventory.db` 文件即可。

**Q: 如何重置数据？**  
A: 删除 `inventory.db` 文件，重新启动服务器会自动创建新数据库。

**Q: npm install 失败？**  
A: 请确保使用 Node.js 14.x 或更高版本。本项目使用 `sql.js` 包，不需要任何编译工具。

**Q: 手机访问显示不正常？**  
A: 界面已优化为响应式设计，支持手机端访问。确保使用现代浏览器（Chrome/Safari/Edge）。

---

## 🌟 特色亮点

1. **双物品类型支持** - 同时管理衣服和其它物品
2. **零编译依赖** - 使用 SQL.js，无需 Visual Studio
3. **纯白简约设计** - 现代化 UI，手机完美适配
4. **智能颜色方案** - 绿色初始、蓝色余量、红色欠货
5. **实时库存统计** - 自动计算剩余，欠货预警
6. **备注功能** - 使用记录可添加备注说明
7. **快速部署** - 单文件前端，一键启动

---

## 📝 更新日志

### v2.0.0 (2025-12-04)

- ✨ 新增"其它物品"管理功能
- ✨ 使用记录增加备注字段
- ✨ 使用流水列表时间列移至最后
- ✨ 物品类型智能切换
- 🎨 优化界面为纯白简约风格
- 🎨 增强手机端响应式支持
- 🔄 从 better-sqlite3 迁移到 sql.js

### v1.0.0 (2025-12-03)

- 🎉 初始版本发布
- ✨ 衣服库存管理功能
- ✨ 使用记录跟踪
- ✨ 剩余总表预览

---

## 📄 许可证

MIT License

---

## 🙏 感谢使用

如有问题或建议，欢迎提交 Issue 或 Pull Request！

**项目地址**: 本地部署  
**技术支持**: README 文档

---

## 📖 相关文档

- [功能演示教程](walkthrough.md) - 详细的使用示例和截图
- [API 在线测试](http://localhost:3000) - 启动后访问
